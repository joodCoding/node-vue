(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["productEdit"],{"0302":function(e,t,r){"use strict";r("871c")},"14d9":function(e,t,r){"use strict";var a=r("23e7"),o=r("7b0b"),c=r("07fa"),n=r("3a34"),l=r("3511"),i=r("d039"),s=i((function(){return 4294967297!==[].push.call({length:4294967296},1)})),u=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},d=s||!u();a({target:"Array",proto:!0,arity:1,forced:d},{push:function(e){var t=o(this),r=c(t),a=arguments.length;l(r+a);for(var i=0;i<a;i++)t[r]=arguments[i],r++;return n(t,r),r}})},"271a":function(e,t,r){"use strict";var a=r("cb2d"),o=r("e330"),c=r("577e"),n=r("d6d6"),l=URLSearchParams,i=l.prototype,s=o(i.getAll),u=o(i.has),d=new l("a=1");!d.has("a",2)&&d.has("a",void 0)||a(i,"has",(function(e){var t=arguments.length,r=t<2?void 0:arguments[1];if(t&&void 0===r)return u(this,e);var a=s(this,e);n(t,1);var o=c(r),l=0;while(l<a.length)if(a[l++]===o)return!0;return!1}),{enumerable:!0,unsafe:!0})},3511:function(e,t,r){"use strict";var a=TypeError,o=9007199254740991;e.exports=function(e){if(e>o)throw a("Maximum allowed index exceeded");return e}},"3a34":function(e,t,r){"use strict";var a=r("83ab"),o=r("e8b5"),c=TypeError,n=Object.getOwnPropertyDescriptor,l=a&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=l?function(e,t){if(o(e)&&!n(e,"length").writable)throw new c("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},5494:function(e,t,r){"use strict";var a=r("83ab"),o=r("e330"),c=r("edd0"),n=URLSearchParams.prototype,l=o(n.forEach);a&&!("size"in n)&&c(n,"size",{get:function(){var e=0;return l(this,(function(){e++})),e},configurable:!0,enumerable:!0})},"55d8":function(e,t,r){"use strict";r.r(t);r("14d9"),r("e9f5"),r("910d"),r("f665"),r("ab43"),r("88a7"),r("271a"),r("5494");var a=r("7a23"),o=r("6605"),c=r("b775"),n=r("3ef4"),l=r("c9a1");const i={class:"product-edit"},s={class:"header-with-button"},u={class:"product-carousel"},d=["src"],b=["src"];var p={__name:"ProductEdit",setup(e){const t=Object(o["d"])(),r=Object(o["c"])(),p=r.params.id,h=Object(a["ref"])([]),f=Object(a["ref"])([]),m=Object(a["ref"])(0),O={name:[{required:!0,message:"请输入产品名称",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:"blur"}],oldPrice:[{required:!0,message:"请输入原价",trigger:"blur"}],tabs:[{type:"array",required:!0,message:"请选择产品标签",trigger:"change"}]};Object(a["onMounted"])(async()=>{await j(),await v()});const j=async()=>{try{const e=await Object(c["b"])("api/shop/"+p);0===(null===e||void 0===e?void 0:e.errno)&&null!==e&&void 0!==e&&e.data&&(f.value=e.data.tabs)}catch(e){n["a"].error(e.message||"获取店铺信息失败")}},v=async()=>{try{const e=await Object(c["b"])(`api/shop/${p}/products`);0===(null===e||void 0===e?void 0:e.errno)&&(null===e||void 0===e?void 0:e.data.length)>0?(console.log(e.data),h.value=e.data.map(e=>(e.tabs=e.tabs.split(",").map(e=>{const t=f.value.find(t=>t.tab===e);return t?e:null}).filter(Boolean),{...e,img:e.imgUrl||"",rawImgFile:null})),console.log(h.value),await Object(a["nextTick"])()):(n["a"].info("该店铺暂无产品，即将返回店铺管理页面"),setTimeout(()=>{t.push("/shop/edit")},1500))}catch(e){n["a"].error(e.message||"获取产品列表失败")}},g=(e,t)=>{h.value[t].rawImgFile=URL.createObjectURL(e.raw),h.value[t].img=e},w=e=>{const t=e.type.startsWith("image/");return t||n["a"].error("只能上传图片文件!"),t},y=async(e,t)=>{console.log(t);try{const r={...h.value[t]};Array.isArray(r.tabs)&&(r.tabs=r.tabs.join(",")),console.log(r);const a=await Object(c["d"])(`/api/shop/${p}/product/${e}`,r,!0);0===a.errno?n["a"].success("产品信息更新成功"):n["a"].error("产品更新失败: "+a.message)}catch(r){console.log(r),n["a"].error(r.message||"产品更新失败")}},V=async(e,r)=>{try{await l["a"].confirm("确定要删除该产品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=await Object(c["a"])(`/api/shop/${p}/product/${e}`);0===a.errno?(n["a"].success("产品删除成功"),h.value.splice(r,1),0===h.value.length?(n["a"].info("该店铺已无产品，即将返回店铺管理页面"),setTimeout(()=>{t.push("/shop/edit")},1500)):r===h.value.length&&(m.value=h.value.length-1)):n["a"].error("产品删除失败: "+a.message)}catch(a){"cancel"!==a&&n["a"].error(a.message||"产品删除失败")}},C=e=>{m.value=e},k=()=>{t.back()};return(e,t)=>{const r=Object(a["resolveComponent"])("el-button"),o=Object(a["resolveComponent"])("el-input"),c=Object(a["resolveComponent"])("el-form-item"),n=Object(a["resolveComponent"])("el-input-number"),l=Object(a["resolveComponent"])("el-checkbox"),p=Object(a["resolveComponent"])("el-checkbox-group"),m=Object(a["resolveComponent"])("Plus"),j=Object(a["resolveComponent"])("el-icon"),v=Object(a["resolveComponent"])("el-upload"),x=Object(a["resolveComponent"])("el-form"),_=Object(a["resolveComponent"])("el-carousel-item"),N=Object(a["resolveComponent"])("el-carousel");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",i,[Object(a["createElementVNode"])("div",s,[t[1]||(t[1]=Object(a["createElementVNode"])("h2",null,"修改产品",-1)),Object(a["createVNode"])(r,{onClick:k},{default:Object(a["withCtx"])(()=>t[0]||(t[0]=[Object(a["createTextVNode"])("返回")])),_:1,__:[0]})]),Object(a["createElementVNode"])("div",u,[Object(a["createVNode"])(N,{ref:"carousel",autoplay:!1,"indicator-position":"none",arrow:"always",onChange:C},{default:Object(a["withCtx"])(()=>[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(h.value,(e,i)=>(Object(a["openBlock"])(),Object(a["createBlock"])(_,{key:e._id},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(x,{model:e,rules:O,"label-width":"120px",onSubmit:Object(a["withModifiers"])(()=>y(e.id,i),["prevent"])},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(c,{label:"产品名称",prop:"name"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(o,{modelValue:e.name,"onUpdate:modelValue":t=>e.name=t,placeholder:"请输入产品名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),Object(a["createVNode"])(c,{label:"价格",prop:"price"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(n,{modelValue:e.price,"onUpdate:modelValue":t=>e.price=t,min:0,precision:2},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),Object(a["createVNode"])(c,{label:"原价",prop:"oldPrice"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(n,{modelValue:e.oldPrice,"onUpdate:modelValue":t=>e.oldPrice=t,min:0,precision:2},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),Object(a["createVNode"])(c,{label:"产品标签",prop:"tabs"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(p,{modelValue:e.tabs,"onUpdate:modelValue":t=>e.tabs=t},{default:Object(a["withCtx"])(()=>[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(f.value,e=>(Object(a["openBlock"])(),Object(a["createBlock"])(l,{key:e.name,label:e.tab},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.name),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),Object(a["createVNode"])(c,{label:"产品图片",prop:"img"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(v,{"on-change":e=>g(e,i),"before-upload":w,"show-file-list":!1,"auto-upload":!1,class:"avatar-uploader"},{default:Object(a["withCtx"])(()=>[e.img&&"string"===typeof e.img?(Object(a["openBlock"])(),Object(a["createElementBlock"])("img",{key:0,src:e.img,class:"avatar"},null,8,d)):Object(a["createCommentVNode"])("",!0),e.rawImgFile&&"string"===typeof e.rawImgFile?(Object(a["openBlock"])(),Object(a["createElementBlock"])("img",{key:1,src:e.rawImgFile,class:"avatar"},null,8,b)):(Object(a["openBlock"])(),Object(a["createBlock"])(j,{key:2,class:"avatar-uploader-icon"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(m)]),_:1}))]),_:2},1032,["on-change"])]),_:2},1024),Object(a["createVNode"])(c,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(r,{type:"primary","native-type":"submit"},{default:Object(a["withCtx"])(()=>t[2]||(t[2]=[Object(a["createTextVNode"])("保存产品修改")])),_:1,__:[2]})]),_:1}),Object(a["createVNode"])(c,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(r,{type:"danger",onClick:t=>V(e.id,i)},{default:Object(a["withCtx"])(()=>t[3]||(t[3]=[Object(a["createTextVNode"])("删除产品")])),_:2,__:[3]},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model","onSubmit"])]),_:2},1024))),128))]),_:1},512)])])}}},h=(r("0302"),r("6b0d")),f=r.n(h);const m=f()(p,[["__scopeId","data-v-50e01d5f"]]);t["default"]=m},"871c":function(e,t,r){},"88a7":function(e,t,r){"use strict";var a=r("cb2d"),o=r("e330"),c=r("577e"),n=r("d6d6"),l=URLSearchParams,i=l.prototype,s=o(i.append),u=o(i["delete"]),d=o(i.forEach),b=o([].push),p=new l("a=1&a=2&b=3");p["delete"]("a",1),p["delete"]("b",void 0),p+""!=="a=2"&&a(i,"delete",(function(e){var t=arguments.length,r=t<2?void 0:arguments[1];if(t&&void 0===r)return u(this,e);var a=[];d(this,(function(e,t){b(a,{key:t,value:e})})),n(t,1);var o,l=c(e),i=c(r),p=0,h=0,f=!1,m=a.length;while(p<m)o=a[p++],f||o.key===l?(f=!0,u(this,o.key)):h++;while(h<m)o=a[h++],o.key===l&&o.value===i||s(this,o.key,o.value)}),{enumerable:!0,unsafe:!0})},"910d":function(e,t,r){"use strict";var a=r("23e7"),o=r("c65b"),c=r("59ed"),n=r("825a"),l=r("46c4"),i=r("c5cc"),s=r("9bdd"),u=r("c430"),d=r("2a62"),b=r("2baa"),p=r("f99f"),h=!u&&!b("filter",(function(){})),f=!u&&!h&&p("filter",TypeError),m=u||h||f,O=i((function(){var e,t,r,a=this.iterator,c=this.predicate,l=this.next;while(1){if(e=n(o(l,a)),t=this.done=!!e.done,t)return;if(r=e.value,s(a,c,[r,this.counter++],!0))return r}}));a({target:"Iterator",proto:!0,real:!0,forced:m},{filter:function(e){n(this);try{c(e)}catch(t){d(this,"throw",t)}return f?o(f,this,e):new O(l(this),{predicate:e})}})},d6d6:function(e,t,r){"use strict";var a=TypeError;e.exports=function(e,t){if(e<t)throw new a("Not enough arguments");return e}},e8b5:function(e,t,r){"use strict";var a=r("c6b6");e.exports=Array.isArray||function(e){return"Array"===a(e)}},f665:function(e,t,r){"use strict";var a=r("23e7"),o=r("c65b"),c=r("2266"),n=r("59ed"),l=r("825a"),i=r("46c4"),s=r("2a62"),u=r("f99f"),d=u("find",TypeError);a({target:"Iterator",proto:!0,real:!0,forced:d},{find:function(e){l(this);try{n(e)}catch(a){s(this,"throw",a)}if(d)return o(d,this,e);var t=i(this),r=0;return c(t,(function(t,a){if(e(t,r++))return a(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})}}]);
//# sourceMappingURL=productEdit.00530ef0.js.map