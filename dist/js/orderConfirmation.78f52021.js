(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["orderConfirmation"],{"0d82":function(e,t,c){},"14d9":function(e,t,c){"use strict";var r=c("23e7"),n=c("7b0b"),o=c("07fa"),s=c("3a34"),a=c("3511"),i=c("d039"),d=i((function(){return 4294967297!==[].push.call({length:4294967296},1)})),l=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},u=d||!l();r({target:"Array",proto:!0,arity:1,forced:u},{push:function(e){var t=n(this),c=o(t),r=arguments.length;a(c+r);for(var i=0;i<r;i++)t[c]=arguments[i],c++;return s(t,c),c}})},"1e48":function(e,t,c){"use strict";c.d(t,"a",(function(){return s}));var r=c("be92");const n=e=>{const t=JSON.stringify(e);localStorage.cartList=t},o=()=>{try{return JSON.parse(localStorage.cartList)}catch(e){return{}}},s=Object(r["b"])("cart",{state:()=>({cartList:{...o()}}),actions:{changeCartItemInfo(e){const{shopId:t,productId:c,productInfo:r,num:o}=e;let s=this.cartList[t]||{shopName:"",productList:{}},a=s.productList[c];a||(r.count=0,a=r),a.count=a.count+o,o>0&&(a.check=!0),a.count<0&&(a.count=0),s.productList[c]=a,this.cartList[t]=s,n(this.cartList)},changeShopName(e){const{shopId:t,shopName:c}=e,r=this.cartList[t]||{shopName:"",productList:{}};r.shopName=c,this.cartList[t]=r,n(this.cartList)},changeCartItemChecked(e){const{shopId:t,productId:c}=e,r=this.cartList[t].productList[c];r.check=!r.check,n(this.cartList)},cleanCartProducts(e){this.cartList[e].productList={},n(this.cartList)},setCartItemsChecked(e){const t=this.cartList[e].productList;if(t)for(let c in t){const e=t[c];e.check=!0}n(this.cartList)},clearCartData(e){this.cartList[e].productList={},n(this.cartList)}}})},"33a7":function(e,t,c){},3454:function(e,t,c){},3511:function(e,t,c){"use strict";var r=TypeError,n=9007199254740991;e.exports=function(e){if(e>n)throw r("Maximum allowed index exceeded");return e}},"3a34":function(e,t,c){"use strict";var r=c("83ab"),n=c("e8b5"),o=TypeError,s=Object.getOwnPropertyDescriptor,a=r&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=a?function(e,t){if(n(e)&&!s(e,"length").writable)throw new o("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},"501c":function(e,t,c){"use strict";c("6aa8")},"6aa8":function(e,t,c){},"75c9":function(e,t,c){"use strict";c.d(t,"a",(function(){return o}));var r=c("7a23"),n=c("1e48");const o=e=>{const t=Object(n["a"])(),{cartList:c}=t,o=(e,c,r,n)=>{t.changeCartItemInfo({shopId:e,productId:c,productInfo:r,num:n})},s=Object(r["computed"])(()=>{var t;const r=(null===(t=c[e])||void 0===t?void 0:t.productList)||{},n={};for(let e in r){const t=r[e];t.count>0&&(n[e]=t)}return n}),a=Object(r["computed"])(()=>{var t;const r=(null===(t=c[e])||void 0===t?void 0:t.shopName)||"";return r}),i=Object(r["computed"])(()=>{var t;const r=null===(t=c[e])||void 0===t?void 0:t.productList,n={total:0,price:0,allChecked:!0};if(r)for(let e in r){const t=r[e];n.total+=t.count,t.check&&(n.price+=t.count*t.price),t.count>0&&!t.check&&(n.allChecked=!1)}return n.price=n.price.toFixed(2),n});return{cartList:c,shopName:a,productList:s,calculations:i,changeCartItemInfo:o}}},"94f1":function(e,t,c){"use strict";c("3454")},b957:function(e,t,c){"use strict";c.r(t);var r=c("7a23");const n={class:"wrapper"};function o(e,t,c,o,s,a){const i=Object(r["resolveComponent"])("TopArea"),d=Object(r["resolveComponent"])("ProductList"),l=Object(r["resolveComponent"])("Order");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",n,[Object(r["createVNode"])(i),Object(r["createVNode"])(d),Object(r["createVNode"])(l)])}c("14d9");var s=c("506a"),a=c("6605"),i=c("b775");const d={class:"top"},l={class:"top__header"},u={class:"top__receiver"},p={class:"top__receiver__address"},b={class:"top__receiver__info"},m={class:"top__receiver__info__name"},h={class:"top__receiver__info__name"},_={key:1};function O(e,t,c,n,o,s){return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",d,[Object(r["createElementVNode"])("div",l,[Object(r["createElementVNode"])("div",{class:"iconfont top__header__back",onClick:t[0]||(t[0]=(...e)=>n.handleBackClick&&n.handleBackClick(...e))},""),t[2]||(t[2]=Object(r["createTextVNode"])(" 确认订单 "))]),Object(r["createElementVNode"])("div",u,[t[5]||(t[5]=Object(r["createElementVNode"])("div",{class:"top__receiver__title"},"收货地址",-1)),n.address?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{key:0,onClick:t[1]||(t[1]=(...e)=>n.handleAddressClick&&n.handleAddressClick(...e))},[Object(r["createElementVNode"])("div",p,Object(r["toDisplayString"])(n.address.city)+Object(r["toDisplayString"])(n.address.department)+Object(r["toDisplayString"])(n.address.houseNumber),1),Object(r["createElementVNode"])("div",b,[Object(r["createElementVNode"])("span",m,Object(r["toDisplayString"])(n.address.name),1),Object(r["createElementVNode"])("span",h,Object(r["toDisplayString"])(n.address.phone),1)]),t[3]||(t[3]=Object(r["createElementVNode"])("div",{class:"iconfont top__receiver__icon"},"",-1))])):(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",_,t[4]||(t[4]=[Object(r["createElementVNode"])("div",{class:"top__receiver__address"}," 暂无可用地址 ",-1)])))])])}c("e9f5"),c("f665");const j=()=>{const e=Object(a["c"])(),t=parseInt(e.params.addressId),c=Object(r["computed"])(()=>{const e=Object(s["a"])(),c=e.addressList;return c.find(e=>e.id===t)||c[0]});return c};var f=j,v={name:"TopArea",setup(){const e=Object(a["d"])(),t=Object(a["c"])(),c=t.params.id,r=()=>{e.back()},n=()=>{e.push("/chooseAddressList/"+c)},o=f();return{handleBackClick:r,handleAddressClick:n,address:o}}},k=(c("501c"),c("6b0d")),N=c.n(k);const C=N()(v,[["render",O],["__scopeId","data-v-275476f1"]]);var E=C;const g={class:"products"},L={class:"products__title"},y={class:"products__wrapper"},V={class:"products__list"},w=["src"],I={class:"products__item__detail"},S={class:"products__item__title"},B={class:"products__item__price"},D={class:"products__item__total"};function T(e,t,c,n,o,s){return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",g,[Object(r["createElementVNode"])("div",L,Object(r["toDisplayString"])(n.shopName),1),Object(r["createElementVNode"])("div",y,[Object(r["createElementVNode"])("div",V,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(n.productList,e=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{key:e.id,class:"products__item"},[Object(r["createElementVNode"])("img",{class:"products__item__img",src:e.imgUrl},null,8,w),Object(r["createElementVNode"])("div",I,[Object(r["createElementVNode"])("h4",S,Object(r["toDisplayString"])(e.name),1),Object(r["createElementVNode"])("p",B,[Object(r["createElementVNode"])("span",null,[t[0]||(t[0]=Object(r["createElementVNode"])("span",{class:"products__item__yen"},"¥ ",-1)),Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.price)+" x "+Object(r["toDisplayString"])(e.count),1)]),Object(r["createElementVNode"])("span",D,[t[1]||(t[1]=Object(r["createElementVNode"])("span",{class:"products__item__yen"},"¥ ",-1)),Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])((e.price*e.count).toFixed(2)),1)])])])]))),128))])])])}var x=c("75c9"),A={name:"ProductList",setup(){const e=Object(a["c"])(),t=e.params.id,{shopName:c,productList:r}=Object(x["a"])(t);return{shopName:c,productList:r}}};c("94f1");const P=N()(A,[["render",T],["__scopeId","data-v-f4ab1a42"]]);var F=P;const J={class:"order"},M={class:"order__price"},R={class:"mask__content__btns"};function U(e,t,c,n,o,s){return Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],null,[Object(r["createElementVNode"])("div",J,[Object(r["createElementVNode"])("div",M,[t[5]||(t[5]=Object(r["createTextVNode"])(" 实付金额 ")),Object(r["createElementVNode"])("b",null,"¥"+Object(r["toDisplayString"])(n.calculations.price),1)]),n.address?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{key:0,class:"order__btn",onClick:t[0]||(t[0]=()=>n.handleShowConfirmChange(!0))}," 提交订单 ")):Object(r["createCommentVNode"])("",!0)]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{class:"mask",onClick:t[4]||(t[4]=()=>n.handleShowConfirmChange(!1))},[Object(r["createElementVNode"])("div",{class:"mask__content",onClick:t[3]||(t[3]=Object(r["withModifiers"])(()=>{},["stop"]))},[t[6]||(t[6]=Object(r["createElementVNode"])("h3",{class:"mask__content__title"},"确认要离开收银台？",-1)),t[7]||(t[7]=Object(r["createElementVNode"])("p",{class:"mask__content__desc"},"请尽快完成支付，否则将被取消",-1)),Object(r["createElementVNode"])("div",R,[Object(r["createElementVNode"])("div",{class:"mask__content__btn mask__content__btn--first",onClick:t[1]||(t[1]=()=>n.handleConfirmOrder(!0))}," 取消订单 "),Object(r["createElementVNode"])("div",{class:"mask__content__btn mask__content__btn--last",onClick:t[2]||(t[2]=()=>n.handleConfirmOrder(!1))}," 确认支付 ")])])],512),[[r["vShow"],n.showConfirm]])],64)}var q=c("1e48");const z=(e,t,c,r)=>{const n=Object(a["d"])(),o=Object(q["a"])(),s=async s=>{const a=[];for(let e in c.value){const t=c.value[e];a.push({id:t.id,num:t.count})}try{const c=await Object(i["d"])("/api/order",{addressId:r.value.id,shopId:e,shopName:t.value,isCanceled:s,products:a});0===(null===c||void 0===c?void 0:c.errno)&&(o.clearCartData(e),n.push({name:"OrderList"}))}catch(d){console.error("下单失败:",d)}};return{handleConfirmOrder:s}},G=()=>{const e=Object(r["ref"])(!1),t=t=>{e.value=t};return{showConfirm:e,handleShowConfirmChange:t}};var H={name:"Order",setup(){const e=Object(a["c"])(),t=e.params.id,c=f(),{calculations:r,shopName:n,productList:o}=Object(x["a"])(t),{handleConfirmOrder:s}=z(t,n,o,c),{showConfirm:i,handleShowConfirmChange:d}=G();return{address:c,showConfirm:i,handleShowConfirmChange:d,calculations:r,handleConfirmOrder:s}}};c("d46c");const K=N()(H,[["render",U],["__scopeId","data-v-5cbb4df5"]]);var Q=K,W={name:"OrderConfirmation",components:{TopArea:E,ProductList:F,Order:Q},setup(){Object(r["onMounted"])(async()=>{const e=Object(a["d"])(),t=Object(s["a"])(),c=t.addressList;if(!c.length){var r;const e=await Object(i["b"])("/api/user/address");null!==e&&void 0!==e&&null!==(r=e.data)&&void 0!==r&&r.length&&t.changeAddressList(e.data)}0===t.addressList.length&&e.push({name:"MyAddressList"})})}};c("e463");const X=N()(W,[["render",o],["__scopeId","data-v-1458a15a"]]);t["default"]=X},d46c:function(e,t,c){"use strict";c("0d82")},e463:function(e,t,c){"use strict";c("33a7")},e8b5:function(e,t,c){"use strict";var r=c("c6b6");e.exports=Array.isArray||function(e){return"Array"===r(e)}},f665:function(e,t,c){"use strict";var r=c("23e7"),n=c("c65b"),o=c("2266"),s=c("59ed"),a=c("825a"),i=c("46c4"),d=c("2a62"),l=c("f99f"),u=l("find",TypeError);r({target:"Iterator",proto:!0,real:!0,forced:u},{find:function(e){a(this);try{s(e)}catch(r){d(this,"throw",r)}if(u)return n(u,this,e);var t=i(this),c=0;return o(t,(function(t,r){if(e(t,c++))return r(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})}}]);
//# sourceMappingURL=orderConfirmation.78f52021.js.map