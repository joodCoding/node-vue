(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["shop"],{"0e6d":function(e,t,c){},"1e48":function(e,t,c){"use strict";c.d(t,"a",(function(){return r}));var a=c("be92");const o=e=>{const t=JSON.stringify(e);localStorage.cartList=t},n=()=>{try{return JSON.parse(localStorage.cartList)}catch(e){return{}}},r=Object(a["b"])("cart",{state:()=>({cartList:{...n()}}),actions:{changeCartItemInfo(e){const{shopId:t,productId:c,productInfo:a,num:n}=e;let r=this.cartList[t]||{shopName:"",productList:{}},s=r.productList[c];s||(a.count=0,s=a),s.count=s.count+n,n>0&&(s.check=!0),s.count<0&&(s.count=0),r.productList[c]=s,this.cartList[t]=r,o(this.cartList)},changeShopName(e){const{shopId:t,shopName:c}=e,a=this.cartList[t]||{shopName:"",productList:{}};a.shopName=c,this.cartList[t]=a,o(this.cartList)},changeCartItemChecked(e){const{shopId:t,productId:c}=e,a=this.cartList[t].productList[c];a.check=!a.check,o(this.cartList)},cleanCartProducts(e){this.cartList[e].productList={},o(this.cartList)},setCartItemsChecked(e){const t=this.cartList[e].productList;if(t)for(let c in t){const e=t[c];e.check=!0}o(this.cartList)},clearCartData(e){this.cartList[e].productList={},o(this.cartList)}}})},"289e":function(e,t,c){},"2cfc":function(e,t,c){},"55b2":function(e,t,c){"use strict";c("289e")},"5f6f":function(e,t,c){"use strict";c.r(t);var a=c("7a23");const o={class:"wrapper"},n={class:"search"};function r(e,t,c,r,s,i){const l=Object(a["resolveComponent"])("ShopInfo"),d=Object(a["resolveComponent"])("Content"),p=Object(a["resolveComponent"])("Cart");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",o,[Object(a["createElementVNode"])("div",n,[Object(a["createElementVNode"])("div",{class:"search__back iconfont",onClick:t[0]||(t[0]=(...e)=>r.handleBackClick&&r.handleBackClick(...e))},"  "),t[1]||(t[1]=Object(a["createElementVNode"])("div",{class:"search__content"},[Object(a["createElementVNode"])("span",{class:"search__content__icon iconfont"},""),Object(a["createElementVNode"])("input",{class:"search__content__input",placeholder:"请输入商品名称"})],-1))]),Object(a["withDirectives"])(Object(a["createVNode"])(l,{item:r.item,hideBorder:!0},null,8,["item"]),[[a["vShow"],r.item.imgUrl]]),Object(a["createVNode"])(d,{shopName:r.item.name},null,8,["shopName"]),Object(a["createVNode"])(p)])}var s=c("6605"),i=c("b775"),l=c("d7d0");const d={class:"content"},p={class:"category"},u=["onClick"],m={class:"product"},b=["src"],h={class:"product__item__detail"},_={class:"product__item__title"},O={class:"product__item__sales"},j={class:"product__item__price"},C={class:"product__item__origin"},k={class:"product__number"},g=["onClick"],v=["onClick"];function N(e,t,c,o,n,r){return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",d,[Object(a["createElementVNode"])("div",p,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(o.categories,e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{class:Object(a["normalizeClass"])({category__item:!0,"category__item--active":o.currentTab===e.tab}),key:e.name,onClick:()=>o.handleTabClick(e.tab)},Object(a["toDisplayString"])(e.name),11,u))),128))]),Object(a["createElementVNode"])("div",m,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(o.list,e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{class:"product__item",key:e.id},[Object(a["createElementVNode"])("img",{class:"product__item__img",src:e.imgUrl},null,8,b),Object(a["createElementVNode"])("div",h,[Object(a["createElementVNode"])("h4",_,Object(a["toDisplayString"])(e.name),1),Object(a["createElementVNode"])("p",O,"月售 "+Object(a["toDisplayString"])(e.sales)+" 件",1),Object(a["createElementVNode"])("p",j,[t[0]||(t[0]=Object(a["createElementVNode"])("span",{class:"product__item__yen"},"¥",-1)),Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.price)+" ",1),Object(a["createElementVNode"])("span",C,"¥"+Object(a["toDisplayString"])(e.oldPrice),1)])]),Object(a["createElementVNode"])("div",k,[Object(a["createElementVNode"])("span",{class:"product__number__minus iconfont",onClick:()=>{o.changeCartItem(o.shopId,e.id,e,-1,c.shopName)}},"",8,g),Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(o.getProductCartCount(o.shopId,e.id))+" ",1),Object(a["createElementVNode"])("span",{class:"product__number__plus iconfont",onClick:()=>{o.changeCartItem(o.shopId,e.id,e,1,c.shopName)}},"",8,v)])]))),128))])])}var I=c("1e48"),f=c("75c9"),E=c("3ef4");const V=(e,t)=>{const c=Object(a["ref"])([]),o=async()=>{var a;const o=await Object(i["b"])(`/api/shop/${t}/products`,{tab:e.value});0===(null===o||void 0===o?void 0:o.errno)&&null!==o&&void 0!==o&&null!==(a=o.data)&&void 0!==a&&a.length&&(c.value=o.data)};return Object(a["watchEffect"])(()=>{o()}),{list:c}},L=e=>{const t=Object(a["ref"])("");Object(a["watchEffect"])(()=>{e.value.length&&(t.value=e.value[0].tab)});const c=e=>{t.value=e};return{currentTab:t,handleTabClick:c}},S=()=>{const e=Object(I["a"])(),{cartList:t,changeCartItemInfo:c}=Object(f["a"])(),a=(t,c)=>{e.changeShopName({shopId:t,shopName:c})},o=(e,t,o,n,r)=>{c(e,t,o,n),a(e,r)},n=(e,c)=>{var a;return(null===t||void 0===t||null===(a=t[e])||void 0===a||null===(a=a.productList)||void 0===a||null===(a=a[c])||void 0===a?void 0:a.count)||0};return{cartList:t,changeCartItem:o,getProductCartCount:n}};var y={name:"Content",props:["shopName"],setup(){const e=Object(s["c"])(),t=e.params.id,c=Object(a["ref"])([{tab:"all",name:"全部"}]),{currentTab:o,handleTabClick:n}=L(c),{list:r}=V(o,t);Object(a["onMounted"])(async()=>{try{const e=await Object(i["b"])("api/shop/"+t);0===(null===e||void 0===e?void 0:e.errno)&&null!==e&&void 0!==e&&e.data&&(c.value=e.data.tabs)}catch(e){E["a"].error(e.message||"获取店铺信息失败")}});const{changeCartItem:l,cartList:d,getProductCartCount:p}=S();return{categories:c,currentTab:o,handleTabClick:n,list:r,shopId:t,changeCartItem:l,cartList:d,getProductCartCount:p}}},B=(c("55b2"),c("6b0d")),w=c.n(B);const D=w()(y,[["render",N],["__scopeId","data-v-7f5cd0c2"]]);var T=D;const P={class:"cart"},x={key:0,class:"product"},F={class:"product__header"},M=["innerHTML"],H={class:"product__header__clear"},J=["innerHTML","onClick"],U=["src"],z={class:"product__item__detail"},R={class:"product__item__title"},$={class:"product__item__price"},q={class:"product__item__origin"},A={class:"product__number"},G=["onClick"],K=["onClick"],Q={class:"check"},W={class:"check__icon"},X={class:"check__icon__tag"},Y={class:"check__info"},Z={class:"check__info__price"},ee={class:"check__btn"};function te(e,t,c,o,n,r){const s=Object(a["resolveComponent"])("router-link");return Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],null,[o.showCart&&o.calculations.total>0?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:0,class:"mask",onClick:t[0]||(t[0]=(...e)=>o.handleCartShowChange&&o.handleCartShowChange(...e))})):Object(a["createCommentVNode"])("",!0),Object(a["createElementVNode"])("div",P,[o.showCart&&o.calculations.total>0?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",x,[Object(a["createElementVNode"])("div",F,[Object(a["createElementVNode"])("div",{class:"product__header__all",onClick:t[1]||(t[1]=()=>o.setCartItemsChecked(o.shopId))},[Object(a["createElementVNode"])("span",{class:"product__header__icon iconfont",innerHTML:o.calculations.allChecked?"":""},null,8,M),t[4]||(t[4]=Object(a["createTextVNode"])(" 全选 "))]),Object(a["createElementVNode"])("div",H,[Object(a["createElementVNode"])("span",{class:"product__header__clear__btn",onClick:t[2]||(t[2]=()=>o.cleanCartProducts(o.shopId))},"清空购物车")])]),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(o.productList,e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:e.id,class:"product__item"},[Object(a["createElementVNode"])("div",{class:"product__item__checked iconfont",innerHTML:e.check?"":"",onClick:()=>o.changeCartItemChecked(o.shopId,e.id)},null,8,J),Object(a["createElementVNode"])("img",{class:"product__item__img",src:e.imgUrl},null,8,U),Object(a["createElementVNode"])("div",z,[Object(a["createElementVNode"])("h4",R,Object(a["toDisplayString"])(e.name),1),Object(a["createElementVNode"])("p",$,[t[5]||(t[5]=Object(a["createElementVNode"])("span",{class:"product__item__yen"},"¥",-1)),Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.price)+" ",1),Object(a["createElementVNode"])("span",q,"¥"+Object(a["toDisplayString"])(e.oldPrice),1)])]),Object(a["createElementVNode"])("div",A,[Object(a["createElementVNode"])("span",{class:"product__number__minus iconfont",onClick:()=>{o.changeCartItemInfo(o.shopId,e.id,e,-1)}},"",8,G),Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.count||0)+" ",1),Object(a["createElementVNode"])("span",{class:"product__number__plus iconfont",onClick:()=>{o.changeCartItemInfo(o.shopId,e.id,e,1)}},"",8,K)])]))),128))])):Object(a["createCommentVNode"])("",!0),Object(a["createElementVNode"])("div",Q,[Object(a["createElementVNode"])("div",W,[Object(a["createElementVNode"])("img",{src:"/basket.png",class:"check__icon__img",onClick:t[3]||(t[3]=(...e)=>o.handleCartShowChange&&o.handleCartShowChange(...e))}),Object(a["createElementVNode"])("div",X,Object(a["toDisplayString"])(o.calculations.total),1)]),Object(a["createElementVNode"])("div",Y,[t[6]||(t[6]=Object(a["createTextVNode"])(" 总计：")),Object(a["createElementVNode"])("span",Z,"¥ "+Object(a["toDisplayString"])(o.calculations.price),1)]),Object(a["withDirectives"])(Object(a["createElementVNode"])("div",ee,[Object(a["createVNode"])(s,{to:{path:"/orderConfirmation/"+o.shopId}},{default:Object(a["withCtx"])(()=>t[7]||(t[7]=[Object(a["createTextVNode"])(" 去结算 ")])),_:1,__:[7]},8,["to"])],512),[[a["vShow"],parseFloat(o.calculations.price)>0]])])])],64)}const ce=e=>{const t=Object(I["a"])();console.log(e);const{productList:c,calculations:a,changeCartItemInfo:o}=Object(f["a"])(e),n=(e,c)=>{t.changeCartItemChecked({shopId:e,productId:c})},r=e=>{t.cleanCartProducts(e)},s=e=>{t.setCartItemsChecked(e)};return{calculations:a,productList:c,cleanCartProducts:r,changeCartItemInfo:o,changeCartItemChecked:n,setCartItemsChecked:s}},ae=()=>{const e=Object(a["ref"])(!1),t=()=>{e.value=!e.value};return{showCart:e,handleCartShowChange:t}};var oe={name:"Cart",setup(){const e=Object(s["c"])(),t=e.params.id,{calculations:c,productList:a,cleanCartProducts:o,changeCartItemInfo:n,changeCartItemChecked:r,setCartItemsChecked:i}=ce(t),{showCart:l,handleCartShowChange:d}=ae();return{calculations:c,shopId:t,productList:a,cleanCartProducts:o,changeCartItemInfo:n,changeCartItemChecked:r,setCartItemsChecked:i,showCart:l,handleCartShowChange:d}}};c("ead4");const ne=w()(oe,[["render",te],["__scopeId","data-v-5aadc042"]]);var re=ne;const se=()=>{const e=Object(s["c"])(),t=Object(a["reactive"])({item:{}}),c=async()=>{const c=await Object(i["b"])("/api/shop/"+e.params.id);0===(null===c||void 0===c?void 0:c.errno)&&null!==c&&void 0!==c&&c.data&&(t.item=c.data)},{item:o}=Object(a["toRefs"])(t);return{item:o,getItemData:c}},ie=()=>{const e=Object(s["d"])(),t=()=>{e.back()};return t};var le={name:"Shop",components:{ShopInfo:l["a"],Content:T,Cart:re},setup(){const{item:e,getItemData:t}=se(),c=ie();return t(),{item:e,handleBackClick:c}}};c("9660");const de=w()(le,[["render",r],["__scopeId","data-v-5121c098"]]);t["default"]=de},"75c9":function(e,t,c){"use strict";c.d(t,"a",(function(){return n}));var a=c("7a23"),o=c("1e48");const n=e=>{const t=Object(o["a"])(),{cartList:c}=t,n=(e,c,a,o)=>{t.changeCartItemInfo({shopId:e,productId:c,productInfo:a,num:o})},r=Object(a["computed"])(()=>{var t;const a=(null===(t=c[e])||void 0===t?void 0:t.productList)||{},o={};for(let e in a){const t=a[e];t.count>0&&(o[e]=t)}return o}),s=Object(a["computed"])(()=>{var t;const a=(null===(t=c[e])||void 0===t?void 0:t.shopName)||"";return a}),i=Object(a["computed"])(()=>{var t;const a=null===(t=c[e])||void 0===t?void 0:t.productList,o={total:0,price:0,allChecked:!0};if(a)for(let e in a){const t=a[e];o.total+=t.count,t.check&&(o.price+=t.count*t.price),t.count>0&&!t.check&&(o.allChecked=!1)}return o.price=o.price.toFixed(2),o});return{cartList:c,shopName:s,productList:r,calculations:i,changeCartItemInfo:n}}},9660:function(e,t,c){"use strict";c("2cfc")},cb8b:function(e,t,c){},d7d0:function(e,t,c){"use strict";var a=c("7a23");const o={class:"shop"},n=["src"],r={class:"shop__content__title"},s={class:"shop__content__tags"},i={class:"shop__content__tag"},l={class:"shop__content__tag"},d={class:"shop__content__tag"},p={class:"shop__content__highlight"};function u(e,t,c,u,m,b){return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",o,[Object(a["createElementVNode"])("img",{src:c.item.imgUrl,class:"shop__img"},null,8,n),Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])({shop__content:!0,"shop__content--bordered":!c.hideBorder})},[Object(a["createElementVNode"])("div",r,Object(a["toDisplayString"])(c.item.name),1),Object(a["createElementVNode"])("div",s,[Object(a["createElementVNode"])("span",i,"月售: "+Object(a["toDisplayString"])(c.item.sales),1),Object(a["createElementVNode"])("span",l,"起送: "+Object(a["toDisplayString"])(c.item.expressLimit),1),Object(a["createElementVNode"])("span",d,"基础运费: "+Object(a["toDisplayString"])(c.item.expressPrice),1)]),Object(a["createElementVNode"])("p",p,Object(a["toDisplayString"])(c.item.slogan),1)],2)])}var m={name:"ShopInfo",props:["item","hideBorder"]},b=(c("dc36"),c("6b0d")),h=c.n(b);const _=h()(m,[["render",u],["__scopeId","data-v-6cd9f502"]]);t["a"]=_},dc36:function(e,t,c){"use strict";c("0e6d")},ead4:function(e,t,c){"use strict";c("cb8b")}}]);
//# sourceMappingURL=shop.d8770dc8.js.map